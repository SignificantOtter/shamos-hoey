!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).shamosHoey=e()}(this,function(){"use strict";class t{constructor(t=[],e=function(t,e){return t<e?-1:t>e?1:0}){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&n(e[s],o)<0&&(r=s,o=e[s]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function e(t,e){return t.x>e.x?1:t.x<e.x?-1:t.y!==e.y?t.y>e.y?1:-1:1}class n{constructor(){return new t([],e)}}class r{constructor(t,e){this.key=t,this.data=e,this.left=null,this.right=null}}function i(t,e,n){if(null===e)return e;let i,o,s;const l=new r;for(i=o=l;;){const r=n(t,e.key);if(r<0){if(null===e.left)break;if(n(t,e.left.key)<0&&(s=e.left,e.left=s.right,s.right=e,null===(e=s).left))break;o.left=e,o=e,e=e.left}else{if(!(r>0))break;if(null===e.right)break;if(n(t,e.right.key)>0&&(s=e.right,e.right=s.left,s.left=e,null===(e=s).right))break;i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=l.right,e.right=l.left,e}function o(t,e,n,o,s){const l=new r(t,e);if(s._size++,null===n)return l.left=l.right=null,l;const h=o(t,(n=i(t,n,o)).key);return h<0?(l.left=n.left,l.right=n,n.left=null):h>=0&&(l.right=n.right,l.left=n,n.right=null),l}function s(t,e,n,r){let o;return null===e?null:0===n(t,(e=i(t,e,n)).key)?(null===e.left?o=e.right:(o=i(t,e.left,n)).right=e.right,r._size--,o):e}function l(t,e,n){let r,o;if(null===e)r=o=null;else{const s=n((e=i(t,e,n)).key,t);0===s?(r=e.left,o=e.right):s<0?(o=e.right,e.right=null,r=e):(r=e.left,e.left=null,o=e)}return{left:r,right:o}}class h{constructor(t=function(t,e){return t>e?1:t<e?-1:0}){this._comparator=t,this._root=null,this._size=0}insert(t,e){return this._root=o(t,e,this._root,this._comparator,this)}add(t,e){return this._root=function(t,e,n,o,s){const l=new r(t,e);if(null===n)return l.left=l.right=null,s._size++,l;const h=o(t,(n=i(t,n,o)).key);return 0===h?n:(h<0?(l.left=n.left,l.right=n,n.left=null):h>0&&(l.right=n.right,l.left=n,n.right=null),s._size++,l)}(t,e,this._root,this._comparator,this)}remove(t){this._root=s(t,this._root,this._comparator,this)}pop(){let t=this._root;if(t){for(;t.left;)t=t.left;return this._root=i(t.key,this._root,this._comparator),this._root=s(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null}findStatic(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null}find(t){return this._root&&(this._root=i(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root}contains(t){let e=this._root;const n=this._comparator;for(;e;){const r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1}forEach(t,e){let n=this._root;const r=[];let i=!1;for(;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this}range(t,e,n,r){const i=[],o=this._comparator;let s,l=this._root;for(;0!==i.length||l;)if(l)i.push(l),l=l.left;else{if((s=o((l=i.pop()).key,e))>0)break;if(o(l.key,t)>=0&&n.call(r,l))return this;l=l.right}return this}keys(){const t=[];return this.forEach(({key:e})=>t.push(e)),t}values(){const t=[];return this.forEach(({data:e})=>t.push(e)),t}min(){return this._root?this.minNode(this._root).key:null}max(){return this._root?this.maxNode(this._root).key:null}minNode(t=this._root){if(t)for(;t.left;)t=t.left;return t}maxNode(t=this._root){if(t)for(;t.right;)t=t.right;return t}at(t){let e=this._root,n=!1,r=0;const i=[];for(;!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null}next(t){let e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n}prev(t){let e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}const r=this._comparator;for(;e;){const i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n}clear(){return this._root=null,this._size=0,this}toList(){return function(t){var e=t,n=[],r=!1;const i={next:null};let o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)}load(t=[],e=[],n=!1){let r=t.length;const i=this._comparator;if(n&&function t(e,n,r,i,o){if(r>=i)return;const s=e[r+i>>1];let l=r-1;let h=i+1;for(;;){do{l++}while(o(e[l],s)<0);do{h--}while(o(e[h],s)>0);if(l>=h)break;let t=e[l];e[l]=e[h],e[h]=t,t=n[l],n[l]=n[h],n[h]=t}t(e,n,r,h,o);t(e,n,h+1,i,o)}(t,e,0,r-1,i),null===this._root)this._root=function t(e,n,r,i,o){const s=o-i;if(s>0){const l=i+Math.floor(s/2),h=n[l],u=r[l],f={key:h,data:u,parent:e};return f.left=t(f,n,r,i,l),f.right=t(f,n,r,l+1,o),f}return null}(this._root,t,e,0,r),this._size=r;else{const n=function(t,e,n=((t,e)=>t-e)){const r={};let i=r,o=t,s=e;for(;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;null!==o?i.next=o:null!==s&&(i.next=s);return r.next}(this.toList(),function(t,e){const n={next:null};let r=n;for(let n=0;n<t.length;n++)r=r.next={key:t[n],data:e[n]};return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=function t(e,n,r){const i=r-n;if(i>0){const o=n+Math.floor(i/2),s=t(e,n,o),l=e.head;return l.left=s,e.head=e.head.next,l.right=t(e,o+1,r),l}return null}({head:n},0,r)}return this}isEmpty(){return null===this._root}get size(){return this._size}toString(t=(t=>t.key)){const e=[];return function t(e,n,r,i,o){if(e){i(`${n}${r?"└── ":"├── "}${o(e)}\n`);const s=n+(r?"    ":"│   ");e.left&&t(e.left,s,!1,i,o),e.right&&t(e.right,s,!0,i,o)}}(this._root,"",!0,t=>e.push(t),t),e.join("")}update(t,e,n){const r=this._comparator;let{left:s,right:h}=l(t,this._root,r);this._size--,r(t,e)<0?h=o(e,n,h,r,this):s=o(e,n,s,r,this),this._root=function(t,e,n){return null===e?t:null===t?e:((e=i(t.key,e,n)).left=t,e)}(s,h,r)}split(t){return l(t,this._root,this._comparator)}}class u{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent,this.segmentAbove=null,this.segmentBelow=null,t.segment=this,t.otherEvent.segment=this}}function f(t,e,n){return(t.x-n.x)*(e.y-n.y)-(e.x-n.x)*(t.y-n.y)}function c(t,n){return t===n?0:0!==f(t.leftSweepEvent,t.rightSweepEvent,n.leftSweepEvent)||0!==f(t.leftSweepEvent,t.rightSweepEvent,n.rightSweepEvent)?t.leftSweepEvent.isSamePoint(n.leftSweepEvent)?t.leftSweepEvent.isBelow(n.rightSweepEvent)?-1:1:t.leftSweepEvent.x===n.leftSweepEvent.x?t.leftSweepEvent.y<n.leftSweepEvent.y?-1:1:1===e(t.leftSweepEvent,n.leftSweepEvent)?n.leftSweepEvent.isAbove(t.leftSweepEvent)?-1:1:t.leftSweepEvent.isBelow(n.leftSweepEvent)?-1:1:1===e(t.leftSweepEvent,n.leftSweepEvent)?1:-1}class a{constructor(){this.tree=new h(c)}addSegment(t){const e=new u(t),n=this.tree.insert(e),r=this.tree.next(n),i=this.tree.prev(n);return null!==r&&(e.segmentAbove=r.key,e.segmentAbove.segmentBelow=e),null!==i&&(e.segmentBelow=i.key,e.segmentBelow.segmentAbove=e),n.key}findSegment(t){const e=this.tree.find(t);return null===e?null:e.key}removeSegmentFromSweepline(t){const e=this.tree.find(t);if(null===e)return;const n=this.tree.next(e),r=this.tree.prev(e);if(null!==n){n.key.segmentBelow=t.segmentBelow}if(null!==r){r.key.segmentAbove=t.segmentAbove}this.tree.remove(t)}testIntersect(t,e){if(null===t||null===e)return!1;if(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent))return!1;const n=t.leftSweepEvent.x,r=t.leftSweepEvent.y,i=t.rightSweepEvent.x,o=t.rightSweepEvent.y,s=e.leftSweepEvent.x,l=e.leftSweepEvent.y,h=e.rightSweepEvent.x,u=e.rightSweepEvent.y,f=(u-l)*(i-n)-(h-s)*(o-r),c=(h-s)*(r-l)-(u-l)*(n-s),a=(i-n)*(r-l)-(o-r)*(n-s);if(0===f)return!1;const g=c/f,p=a/f;return g>=0&&g<=1&&p>=0&&p<=1}}class g{constructor(t){this.x=t[0],this.y=t[1],this.otherEvent=null,this.isLeftEndpoint=null,this.segment=null}isOtherEndOfSegment(t){return this===t.otherEvent}isSamePoint(t){return this.x===t.x&&this.y===t.y}isBelow(t){return this.isLeftEndpoint?f(this,this.otherEvent,t)>0:f(this.otherEvent,t,this)>0}isAbove(t){return!this.isBelow(t)}}return class{constructor(){this._eventQueue=new n}addData(t,r){if(void 0!==r){const t=new n;for(let e=0;e<r.length;e++)t.push(r.data[e]);this._eventQueue=t}!function(t,n){const r="Feature"===t.type?t.geometry:t;let i=r.coordinates;"Polygon"!==r.type&&"MultiLineString"!==r.type||(i=[i]),"LineString"===r.type&&(i=[[i]]);for(let t=0;t<i.length;t++)for(let r=0;r<i[t].length;r++)for(let o=0;o<i[t][r].length-1;o++){const s=new g(i[t][r][o]),l=new g(i[t][r][o+1]);s.otherEvent=l,l.otherEvent=s,e(s,l)>0?(l.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,l.isLeftEndpoint=!1),n.push(s),n.push(l)}}(t,this._eventQueue)}cloneEventQueue(){const t=new n;for(let e=0;e<this._eventQueue.length;e++)t.push(this._eventQueue.data[e]);return t}isSimple(){const t=new a;let e=null;for(;this._eventQueue.length;){const n=this._eventQueue.pop();if(n.isLeftEndpoint){if(e=t.addSegment(n),t.testIntersect(e,e.segmentAbove))return!1;if(t.testIntersect(e,e.segmentBelow))return!1}else{if(!n.segment)continue;if(t.testIntersect(n.segment.segmentAbove,n.segment.segmentBelow))return!1;t.removeSegmentFromSweepline(n.segment)}}return!0}}});
